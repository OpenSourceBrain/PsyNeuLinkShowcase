<Lems>


    <ComponentType  name="fnCell"
                    extends="baseCellMembPotDL"
                    description="The Fitzhugh Nagumo model...">

        <Parameter name="a" dimension="none"/>
        <Parameter name="b" dimension="none"/>
        <Parameter name="phi" dimension="none"/>

        <!-- Initial Conditions -->
        <Parameter name="V0" dimension="none"/>
        <Parameter name="W0" dimension="none"/>

        <Constant name="TS" dimension="time" value="1ms"/>
       
        <Attachments name="synapses" type="basePointCurrentDL"/>

        <!-- <Exposure name="V" dimension="none"/> --> <!-- Already exposed from baseCellMembPotDL -->
        <Exposure name="W" dimension="none"/>
        <Exposure name="F" dimension="none"/>

        <Dynamics>

            <StateVariable name="V" dimension="none" exposure="V"
                           description="V plays the role of the membrane potential"/>
            <StateVariable name="W" dimension="none" exposure="W"
                           description="W plays the role of a recovery variable"/>

            <!-- F must be a cubic polynomial in V -->
            <DerivedVariable name="F" dimension="none" exposure="F" value="V - (V^3 / 3)"/>

            <DerivedVariable name="ISyn" dimension="none" select="synapses[*]/I" reduce="add" />

            <TimeDerivative variable="V" value="(F - W + ISyn) / TS"/>
            <TimeDerivative variable="W" value="phi * (V + a - b * W) / TS"/>

            <OnStart>
                <StateAssignment variable="V" value="V0"/>
                <StateAssignment variable="W" value="W0"/>
            </OnStart>

            <OnCondition test="V .gt. 0">
                <EventOut port="spike"/>
            </OnCondition>
            
            
        </Dynamics>
    </ComponentType>

    
</Lems>